# OpenZool ERP 服务器部署指南

## 连接到服务器

### 使用远程桌面连接

1. 按 `Win + R` 打开运行对话框
2. 输入 `mstsc` 并回车
3. 输入服务器信息：
   - 计算机: `68.183.230.252`
   - 用户名: `Administrator`
   - 密码: `make0.0.0`
4. 点击"连接"

## 在服务器上部署

### 方式一：使用自动部署脚本（最简单）

1. **打开 PowerShell（管理员）**
   - 右键点击开始菜单
   - 选择"Windows PowerShell (管理员)"

2. **下载并运行部署脚本**
   ```powershell
   # 下载部署脚本
   cd C:\
   Invoke-WebRequest -Uri "https://raw.githubusercontent.com/wudi22148-del/openzool-erp/main/server-deploy.ps1" -OutFile "server-deploy.ps1"

   # 允许脚本执行
   Set-ExecutionPolicy -ExecutionPolicy Bypass -Scope Process -Force

   # 运行部署脚本
   .\server-deploy.ps1
   ```

3. **等待部署完成**
   - 脚本会自动安装所有依赖
   - 构建前端
   - 启动后端服务
   - 配置防火墙

### 方式二：手动部署（逐步执行）

#### 步骤 1: 检查必要软件

```powershell
# 检查 Node.js
node --version

# 检查 Git
git --version

# 如果没有安装，请先安装：
# Node.js: https://nodejs.org/ (下载 v20 LTS)
# Git: https://git-scm.com/download/win
```

#### 步骤 2: 克隆项目

```powershell
# 创建项目目录
cd C:\
mkdir projects
cd projects

# 克隆项目
git clone https://github.com/wudi22148-del/openzool-erp.git
cd openzool-erp
```

#### 步骤 3: 安装依赖

```powershell
# 安装 pnpm
npm install -g pnpm

# 安装项目依赖
pnpm install
```

#### 步骤 4: 构建前端

```powershell
pnpm build
```

#### 步骤 5: 安装 PM2

```powershell
npm install -g pm2
```

#### 步骤 6: 启动后端服务

```powershell
# 进入后端目录
cd C:\projects\openzool-erp\apps\backend-mock

# 启动服务
pm2 start "pnpm start" --name openzool-erp-backend

# 保存配置
pm2 save

# 设置开机自启
pm2 startup
```

#### 步骤 7: 配置防火墙

```powershell
# 允许后端端口
netsh advfirewall firewall add rule name="OpenZool ERP Backend" dir=in action=allow protocol=TCP localport=3004

# 允许前端端口
netsh advfirewall firewall add rule name="OpenZool ERP Frontend" dir=in action=allow protocol=TCP localport=80
```

## 验证部署

### 1. 检查服务状态

```powershell
pm2 status
```

应该看到 `openzool-erp-backend` 状态为 `online`

### 2. 查看日志

```powershell
pm2 logs openzool-erp-backend
```

### 3. 测试后端 API

在服务器上打开浏览器，访问：
- http://localhost:3004

或在本地浏览器访问：
- http://68.183.230.252:3004

## 配置前端（下一步）

### 选项 A: 使用 Nginx（推荐）

1. **下载 Nginx**
   - 访问: http://nginx.org/en/download.html
   - 下载 Windows 版本
   - 解压到 `C:\nginx`

2. **配置 Nginx**
   ```powershell
   # 下载配置文件
   cd C:\nginx\conf
   Invoke-WebRequest -Uri "https://raw.githubusercontent.com/wudi22148-del/openzool-erp/main/nginx.conf" -OutFile "nginx.conf"
   ```

3. **启动 Nginx**
   ```powershell
   cd C:\nginx
   start nginx
   ```

4. **使用 PM2 管理 Nginx（可选）**
   ```powershell
   pm2 start nginx.exe --name nginx
   pm2 save
   ```

### 选项 B: 使用 IIS

参考项目中的 `IIS-NGINX-GUIDE.md` 文档

## 访问系统

配置完 Nginx/IIS 后：
- 前端: http://68.183.230.252
- 后端 API: http://68.183.230.252:3004

### 默认登录账号
- 用户名: `vben`
- 密码: `123456`

## 常用管理命令

```powershell
# 查看服务状态
pm2 status

# 查看日志
pm2 logs openzool-erp-backend

# 重启服务
pm2 restart openzool-erp-backend

# 停止服务
pm2 stop openzool-erp-backend

# 删除服务
pm2 delete openzool-erp-backend
```

## 更新系统

```powershell
# 停止服务
pm2 stop openzool-erp-backend

# 更新代码
cd C:\projects\openzool-erp
git pull

# 安装依赖
pnpm install

# 重新构建
pnpm build

# 重启服务
pm2 restart openzool-erp-backend
```

## 故障排查

### 问题 1: 端口被占用

```powershell
# 查看端口占用
netstat -ano | findstr :3004

# 结束进程
taskkill /PID 进程ID /F
```

### 问题 2: 服务无法启动

```powershell
# 查看详细日志
pm2 logs openzool-erp-backend --lines 100

# 手动测试启动
cd C:\projects\openzool-erp\apps\backend-mock
pnpm start
```

### 问题 3: 无法访问

- 检查防火墙设置
- 检查云服务商安全组规则
- 确认服务正在运行

## 需要帮助？

- GitHub: https://github.com/wudi22148-del/openzool-erp
- Issues: https://github.com/wudi22148-del/openzool-erp/issues

---

**OpenZool ERP** - 让企业管理更简单
